generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Main category (Men's, Women's, Accessories)
model Category {
  id            String        @id @default(cuid())
  name          String        @unique
  slug          String        @unique
  displayOrder  Int           @default(0)
  subcategories Subcategory[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

// Subcategory (Bottoms, Tops, Bras, etc.)
model Subcategory {
  id           String      @id @default(cuid())
  name         String
  slug         String
  displayOrder Int         @default(0)
  categoryId   String
  category     Category    @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  sizeCharts   SizeChart[]
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  @@unique([categoryId, slug])
  @@index([categoryId])
}

// Size Chart (e.g., "Regular Fit", "Contour Fit")
model SizeChart {
  id            String            @id @default(cuid())
  name          String
  slug          String
  description   String?
  subcategoryId String
  subcategory   Subcategory       @relation(fields: [subcategoryId], references: [id], onDelete: Cascade)
  columns       SizeChartColumn[]
  rows          SizeChartRow[]
  isPublished   Boolean           @default(false)
  displayOrder  Int               @default(0)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  @@unique([subcategoryId, slug])
  @@index([subcategoryId])
  @@index([isPublished])
}

// Column definitions for a size chart (dynamic columns)
model SizeChartColumn {
  id           String          @id @default(cuid())
  sizeChartId  String
  sizeChart    SizeChart       @relation(fields: [sizeChartId], references: [id], onDelete: Cascade)
  name         String
  columnType   ColumnType
  unit         MeasurementUnit @default(NONE)
  displayOrder Int             @default(0)
  cells        SizeChartCell[]
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  @@index([sizeChartId])
}

// Row definitions (each row represents a size)
model SizeChartRow {
  id           String          @id @default(cuid())
  sizeChartId  String
  sizeChart    SizeChart       @relation(fields: [sizeChartId], references: [id], onDelete: Cascade)
  displayOrder Int             @default(0)
  cells        SizeChartCell[]
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  @@index([sizeChartId])
}

// Cell values (intersection of row and column)
model SizeChartCell {
  id             String          @id @default(cuid())
  rowId          String
  columnId       String
  row            SizeChartRow    @relation(fields: [rowId], references: [id], onDelete: Cascade)
  column         SizeChartColumn @relation(fields: [columnId], references: [id], onDelete: Cascade)
  valueInches    Float?
  valueText      String?
  valueMinInches Float?
  valueMaxInches Float?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  @@unique([rowId, columnId])
  @@index([rowId])
  @@index([columnId])
}

// Column type enum
enum ColumnType {
  MEASUREMENT
  SIZE_LABEL
  REGIONAL_SIZE
  BAND_SIZE
  CUP_SIZE
}

// Measurement unit enum
enum MeasurementUnit {
  INCHES
  CM
  NONE
}
