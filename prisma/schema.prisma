generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// USER-DEFINED LABELS (for translation keys)
// ============================================

// Label types for different sizing contexts
enum LabelType {
  ALPHA_SIZE      // XS, SM, MD, LG, XL, XXL, etc.
  NUMERIC_SIZE    // 0, 2, 4, 6, 8, 10, etc.
  YOUTH_SIZE      // YXS, YSM, YMD, YLG, YXL
  TODDLER_SIZE    // 2T, 3T, 4T
  INFANT_SIZE     // 0-3M, 3-6M, 6-12M, etc.
  BAND_SIZE       // 30, 32, 34, 36, etc.
  CUP_SIZE        // A, B, C, D, DD, DDD
  SHOE_SIZE_US    // 5, 5.5, 6, 6.5, etc.
  SHOE_SIZE_EU    // 35, 36, 37, etc.
  SHOE_SIZE_UK    // 3, 3.5, 4, etc.
  REGIONAL        // EU, UK, Asia Pacific codes
  CUSTOM          // User-defined for edge cases
}

// User-defined labels for size values
// These provide consistent keys for translation in consuming apps
model SizeLabel {
  id           String    @id @default(cuid())
  key          String    @unique  // e.g., "SIZE_SM", "BRA_34B", "SHOE_US_9"
  displayValue String              // Default display: "SM", "34B", "9"
  labelType    LabelType
  sortOrder    Int       @default(0)  // For ordering in dropdowns
  description  String?              // Optional help text
  cells        SizeChartCell[]
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([labelType])
  @@index([sortOrder])
}

// ============================================
// CATEGORIES & SUBCATEGORIES
// ============================================

// Main category (Men's, Women's, Boys, Girls)
model Category {
  id            String        @id @default(cuid())
  name          String        @unique
  slug          String        @unique
  displayOrder  Int           @default(0)
  subcategories Subcategory[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

// Subcategory (Tops, Bottoms, Footwear, etc.)
model Subcategory {
  id           String                    @id @default(cuid())
  name         String
  slug         String
  displayOrder Int                       @default(0)
  categoryId   String
  category     Category                  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  sizeCharts   SizeChartSubcategory[]    // Changed to many-to-many
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt

  @@unique([categoryId, slug])
  @@index([categoryId])
}

// ============================================
// SIZE CHARTS (Many-to-Many with Subcategories)
// ============================================

// Join table for SizeChart <-> Subcategory (many-to-many)
model SizeChartSubcategory {
  id            String      @id @default(cuid())
  sizeChartId   String
  subcategoryId String
  sizeChart     SizeChart   @relation(fields: [sizeChartId], references: [id], onDelete: Cascade)
  subcategory   Subcategory @relation(fields: [subcategoryId], references: [id], onDelete: Cascade)
  displayOrder  Int         @default(0)  // Order within this subcategory
  createdAt     DateTime    @default(now())

  @@unique([sizeChartId, subcategoryId])
  @@index([sizeChartId])
  @@index([subcategoryId])
}

// Size Chart (e.g., "Gloves", "Big Kids Tops")
model SizeChart {
  id            String                  @id @default(cuid())
  slug          String                  @unique  // User-editable ID, now globally unique
  name          String
  description   String?
  subcategories SizeChartSubcategory[]  // Many-to-many relationship
  columns       SizeChartColumn[]
  rows          SizeChartRow[]
  isPublished   Boolean                 @default(false)
  createdAt     DateTime                @default(now())
  updatedAt     DateTime                @updatedAt

  @@index([isPublished])
  @@index([slug])
}

// Column definitions for a size chart (dynamic columns)
model SizeChartColumn {
  id           String          @id @default(cuid())
  sizeChartId  String
  sizeChart    SizeChart       @relation(fields: [sizeChartId], references: [id], onDelete: Cascade)
  name         String
  columnType   ColumnType
  displayOrder Int             @default(0)
  cells        SizeChartCell[]
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  @@index([sizeChartId])
}

// Row definitions (each row represents a size)
model SizeChartRow {
  id           String          @id @default(cuid())
  sizeChartId  String
  sizeChart    SizeChart       @relation(fields: [sizeChartId], references: [id], onDelete: Cascade)
  displayOrder Int             @default(0)
  cells        SizeChartCell[]
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  @@index([sizeChartId])
}

// Cell values (intersection of row and column)
// Now stores BOTH inches and cm explicitly, plus optional label reference
model SizeChartCell {
  id          String           @id @default(cuid())
  rowId       String
  columnId    String
  row         SizeChartRow     @relation(fields: [rowId], references: [id], onDelete: Cascade)
  column      SizeChartColumn  @relation(fields: [columnId], references: [id], onDelete: Cascade)

  // For label/text columns - links to SizeLabel for consistent keys
  labelId     String?
  label       SizeLabel?       @relation(fields: [labelId], references: [id], onDelete: SetNull)
  valueText   String?          // Fallback text if no label selected

  // For measurement columns - store BOTH units explicitly
  valueInches    Float?
  valueCm        Float?
  valueMinInches Float?
  valueMaxInches Float?
  valueMinCm     Float?
  valueMaxCm     Float?

  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@unique([rowId, columnId])
  @@index([rowId])
  @@index([columnId])
  @@index([labelId])
}

// Column type enum
enum ColumnType {
  MEASUREMENT     // Numeric measurement (chest, waist, etc.)
  SIZE_LABEL      // Size label (XS, SM, MD, etc.)
  REGIONAL_SIZE   // Regional size conversion (EU, UK, etc.)
  BAND_SIZE       // Bra band size
  CUP_SIZE        // Bra cup size
  SHOE_SIZE       // Shoe size (US, EU, UK)
  TEXT            // Free-form text (for edge cases)
}

// Removed MeasurementUnit enum - we now store both inches and cm explicitly
